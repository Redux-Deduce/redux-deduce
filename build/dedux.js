!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("dedux",[],t):"object"==typeof exports?exports.dedux=t():e.dedux=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t,r){"use strict";var n=Symbol("id"),i=Symbol("foreign key"),o=Symbol("proxy"),u=Symbol("entity"),a=Symbol("get-normalized"),c=Symbol("get-schema"),f=Symbol("root data"),l=Symbol("replace");e.exports={entity:u,id:n,foreignKey:i,getNormalized:a,getSchema:c,getRootData:f,replace:l,proxy:o}},function(e,t,r){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var u=r(9),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._entity=t}return o(e,[{key:"typeOf",value:function(e){var t=void 0===e?"undefined":i(e);return"object"!==t?t:null===e?"null":Array.isArray(e)?"array":"object"}},{key:"getElements",value:function(e){return"object"===this.typeOf(e)?Object.entries(e):"array"===this.typeOf(e)?e.map(function(e,t){return[t,e]}):void 0}},{key:"getName",value:function(e){return"string"===this.typeOf(e)?e:e.name}},{key:"isEntity",value:function(e){return!("object"!==this.typeOf(e)||!e[this._entity])}},{key:"isVacentTag",value:function(e){if(!this.isEntity(e))return!1;var t=Object.getOwnPropertySymbols(e).concat(Object.getOwnPropertyNames(e));return 1===t.length&&t[0]===this._entity}},{key:"validateTag",value:function(e){if("string"===this.typeOf(e))return t(e);if("object"===this.typeOf(e)){if("string"===this.typeOf(e.name))return t(e.name);throw new Error("Invalid Tag. \n\n            "+JSON.stringify(e)+" \n\n            Tag must contain a 'name' property with a string value")}throw new Error("Invalid Tag. \n\n         "+e+" \n\n         Tag must be a string or an object with a 'name' property and a string value");function t(e){if(e[0].toUpperCase()!==e[0]){if(!["number","string","boolean","function","null","undefined","object","array"].includes(e))throw new Error("Invalid Tag. "+e+" is not a valid primitive.")}}}},{key:"checkForInconsistencies",value:function(e,t,r){if(e&&t&&!u(e,t,{strict:!0}))throw new Error("Conflicting Schema definitions for "+r+". \n\n        "+JSON.stringify(e)+" \n\n        does not match \n\n        "+JSON.stringify(t))}},{key:"checkForUndefinedEntities",value:function(e){Object.entries(e).forEach(function(e){var t=n(e,2),r=t[0];if(void 0===t[1])throw new Error("Could not infer Schema on "+r)})}}]),e}();e.exports=a},function(e,t,r){"use strict";var n=r(0),i=(n.replace,n.entity),o=new(r(1))(i);e.exports=function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"object"===o.typeOf(t)?!!o.isEntity(t)||Object.values(t).reduce(function(t,n){return t||e(n,r)},r):"array"===o.typeOf(t)&&t.reduce(function(t,n){return t||e(n,r)},r)}},function(e,t,r){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a=r(0),c=a.entity,f=a.id,l=a.foreignKey,s=a.proxy,y=new(r(1))(c),v=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._schema=t,this._rootEntity=r,this._normalized=function(e){var t={};return Reflect.ownKeys(e).forEach(function(e){return t[e]={}}),t}(t)}return o(e,[{key:"addToTable",value:function(e){var t,r=y.getName(e[c]),n=this._schema[r][f]++;return e[f]=n,this._normalized[r][n]=e,u(t={},l,n),u(t,"entityType",r),t}},{key:"addProxy",value:function(e,t){var r=this._schema[s][f]++;return e[s]=r,this._normalized[s][r]=i({},t,u({},f,r)),r}},{key:"getNormalizedData",value:function(){return{normalizedData:this._normalized,rootEntity:this._rootEntity,schema:this._schema}}}]),e}();e.exports=function(e,t){var r=new v(e,t);return function e(t,o){var a,c=o.parents,f=o.path,l=y.getElements(t);if(!l)return t;if(a=t,y.typeOf("array"===a)&&y.isVacentTag(a[0]))return[];var s=y.isEntity(t)&&r.addToTable(t);s&&(f=[s]);var v=r.addProxy(t,{parents:c,path:f});return c=i({},c,u({},v,!0)),l.forEach(function(r){var i=n(r,2),o=i[0],u=i[1];t[o]=e(u,{parents:c,path:[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(f),[o])})}),s||t}(t,{parents:{},path:[]}),r.getNormalizedData()}},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function u(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function a(e){return Array.isArray(e)?e:Array.from(e)}var c=r(0),f=c.entity,l=c.id,s=c.foreignKey,y=c.proxy,v=[f,l,s,y],d=new(r(1))(f),h=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._old=t,this._new={},this._oldRoot=r,this._proxyRemovalList=new Set}return o(e,[{key:"getEntity",value:function(e,t){return this._old[e][t]}},{key:"getPath",value:function(e){var t=e[y];return this._old[y][t].path}},{key:"addNewEntity",value:function(e){var t=d.getName(e[f]),r=e[l];this._new[t]||(this._new[t]={}),this._new[t][r]=e}},{key:"mergeAtPath",value:function(e,t,r){if(0===e.length)return this.merge(t,r);this.addToProxyRemovalList(t);var i=a(e),o=i[0],c=i.slice(1),f=function(e,t,r){if("object"===d.typeOf(t))return n({},t,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},e,r));if("array"===d.typeOf(t)){var i=t.slice(0,e),o=t.slice(e+1);return[].concat(u(i),[r],u(o))}}(o,t,this.mergeAtPath(c,t[o],r));if(!d.isEntity(f))return f;this.addNewEntity(f)}},{key:"merge",value:function(e,t){var r,n=this;if(r=e,"object"===d.typeOf(r)&&Object.getOwnPropertySymbols(r).includes(s)){var o=this.getEntity(e.entityType,e[s]);return this.merge(o,t),e}var u=d.getElements(t);return u?this.getEntity(y,e[y]).proxy===t?e:(Object.getOwnPropertySymbols(e).filter(function(e){return v.includes(e)}).forEach(function(r){return t[r]=e[r]}),u.forEach(function(r){var o=i(r,2),u=o[0],a=o[1];return t[u]=n.merge(e[u],a)}),this.addToProxyRemovalList(t),d.isEntity(t)?void this.addNewEntity(t):t):t}},{key:"addToProxyRemovalList",value:function(e){this._proxyRemovalList.add(e[y])}},{key:"addParentProxies",value:function(e){var t=this;this.getProxyParents(e).forEach(function(e){t._proxyRemovalList.has(e)||(t._proxyRemovalList.add(e),t.addParentProxies(e))})}},{key:"getProxyParents",value:function(e){var t=this._old[y][e].parents;return Object.keys(t)}},{key:"clearProxies",value:function(){var e=this._proxyRemovalList.values(),t=!0,r=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(t=(u=a.next()).done);t=!0){var c=u.value;this.addParentProxies(c)}}catch(e){r=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw o}}e=this._proxyRemovalList.values();var f={};Object.entries(this._old[y]).forEach(function(e){var t=i(e,2),r=t[0],o=t[1];return f[r]=n({},o)});var l=!0,s=!1,v=void 0;try{for(var d,h=e[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var p=d.value;f[p].proxy=void 0}}catch(e){s=!0,v=e}finally{try{!l&&h.return&&h.return()}finally{if(s)throw v}}this._new[y]=f}},{key:"mergeInOldData",value:function(){var e=this;Object.entries(this._old).forEach(function(t){var r=i(t,2),o=r[0],u=r[1];e._new[o]?e._new[o]=n({},u,e._new[o]):e._new[o]=u})}},{key:"getNewRoot",value:function(){var e=this._oldRoot[f],t=this._oldRoot[l];return this._new[e][t]}},{key:"getNewData",value:function(){return this._new}}]),e}();e.exports=function(e,t,r,n){var i=new h(e,t),o=a(i.getPath(r)),u=o[0],c=u[s],f=u.entityType,l=o.slice(1),y=i.getEntity(f,c);return i.mergeAtPath(l,y,n),i.clearProxies(),i.mergeInOldData(),{normalizedData:i.getNewData(),rootEntity:i.getNewRoot()}}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=r(0),o=i.entity,u=(i.id,i.foreignKey,i.proxy),a=(new(r(1))(o),r(4)),c=function(){function e(t){var r=t.schema,n=t.normalizedData,i=t.rootEntity;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schema=r,this.normalizedData=n,this.rootEntity=i}return n(e,[{key:"getEntity",value:function(e,t){return this.normalizedData[e][t]}},{key:"getSchema",value:function(){return this.schema}},{key:"getRoot",value:function(){return this.rootEntity}},{key:"getNormalizedData",value:function(){return this.normalizedData}},{key:"getProxyFromCache",value:function(e){var t=e[u];return this.normalizedData[u][t].proxy}},{key:"setProxyInCache",value:function(e,t){var r=e[u];this.normalizedData[u][r].proxy=t}},{key:"replace",value:function(t,r){var n=a(this.normalizedData,this.rootEntity,t,r);return new e({normalizedData:n.normalizedData,rootEntity:n.rootEntity,schema:this.schema})}}]),e}();e.exports=c},function(e,t,r){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var u=r(0),a=u.entity,c=u.id,f=u.proxy,l=new(r(1))(a),s=function(){function e(){var t,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._schema=(n={},(r=f)in(t={})?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t)}return o(e,[{key:"addType",value:function(e){var t=e[a];l.validateTag(t);var r=l.getName(t);return delete e[a],this._schema[r]?l.checkForInconsistencies(e,this.schema[r],r):this._schema[r]=e,r}},{key:"addVacantType",value:function(e){var t=e[a];l.validateTag(t);var r=l.getName(t);return this._schema[r]||(this._schema[r]=void 0),r}},{key:"getSchema",value:function(){var e=this,t=Reflect.ownKeys(this._schema);return l.checkForUndefinedEntities(this._schema),t.forEach(function(t){return e._schema[t][c]=0}),this._schema}}]),e}();e.exports=function(e){var t=new s;return e[a]||(e[a]="ROOT"),function e(r){if("array"===l.typeOf(r))return[e(r[0])];if("object"===l.typeOf(r)){if(l.isVacentTag(r))return t.addVacantType(r);var o=i({},r);return Object.entries(o).forEach(function(t){var r=n(t,2),i=r[0],u=r[1];return o[i]=e(u)}),l.isEntity(o)?t.addType(o):o}return l.typeOf(r)}(e),t.getSchema()}},function(e,t){var r="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function n(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function i(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=r?n:i).supported=n,t.unsupported=i},function(e,t){function r(e){var t=[];for(var r in e)t.push(r);return t}(e.exports="function"==typeof Object.keys?Object.keys:r).shim=r},function(e,t,r){var n=Array.prototype.slice,i=r(8),o=r(7),u=e.exports=function(e,t,r){return r||(r={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?r.strict?e===t:e==t:function(e,t,r){var f,l;if(a(e)||a(t))return!1;if(e.prototype!==t.prototype)return!1;if(o(e))return!!o(t)&&(e=n.call(e),t=n.call(t),u(e,t,r));if(c(e)){if(!c(t))return!1;if(e.length!==t.length)return!1;for(f=0;f<e.length;f++)if(e[f]!==t[f])return!1;return!0}try{var s=i(e),y=i(t)}catch(e){return!1}if(s.length!=y.length)return!1;for(s.sort(),y.sort(),f=s.length-1;f>=0;f--)if(s[f]!=y[f])return!1;for(f=s.length-1;f>=0;f--)if(l=s[f],!u(e[l],t[l],r))return!1;return typeof e==typeof t}(e,t,r))};function a(e){return null===e||void 0===e}function c(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=r(0),o=i.entity,u=i.id,a=i.foreignKey,c=i.getNormalized,f=i.getSchema,l=i.getRootData,s=i.replace,y=i.proxy,v=i.dataProxy,d=i.schemaProxy,h=i.normalizedProxy,p=[o,u,a,y,c,h,f,d,l,v,s],E={data:[],schema:[o],normalized:[u,a]},b=new(r(1))(o),m=r(6),g=r(5),w=r(3);var _=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._proxyType=r,this._normalizedData=t,"data"===r?this._getProxy(t.getRoot()):"normalized"===r?this._getProxy(t.getNormalizedData()):"schema"===r?this._getProxy(t.getSchema()):void 0}return n(e,[{key:"_getProxy",value:function(e){if("data"!==this._proxyType)return this._createProxy(e);var t=this._normalizedData.getProxyFromCache(e);return t||(t=this._createProxy(e),this._normalizedData.setProxyInCache(e,t)),t}},{key:"_createProxy",value:function(t){var r=this,n=E[this._proxyType];return new Proxy(t,{get:function(t,i){return i===c?new e(r._normalizedData,"normalized"):i===f?new e(r._normalizedData,"schema"):i===l?r._getProxy(r._normalizedData.getRoot()):i===s?r._updateFn(t):n.includes(i)?r._lookupValue(t[i]):p.includes(i)?void 0:r._lookupValue(t[i])},ownKeys:function(e){var t=p.filter(function(e){return!n.includes(e)});return Reflect.ownKeys(e).filter(function(e){return!t.includes(e)})}})}},{key:"_updateFn",value:function(t){var r=this;return function(n){return new e(r._normalizedData.replace(t,n))}}},{key:"_lookupValue",value:function(e){var t=b.typeOf(e);if("object"!==t&&"array"!==t)return e;if("object"===t&&"data"===this._proxyType&&Object.getOwnPropertySymbols(e).includes(a)){var r=this._normalizedData.getEntity(e.entityType,e[a]);return this._getProxy(r)}return this._getProxy(e)}}]),e}();e.exports=function(e){var t=m(e),r=w(t,e),n=new g(r);return new _(n)}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e,t){if(void 0===e)return[];var r=[];return function e(t,r,i,o){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(""!==r&&(u+=(u?"_":"")+r.toUpperCase()),u===t||u.endsWith("_"+t))o(u);else{if("object"!==(void 0===i?"undefined":n(i))||Array.isArray(i))return;var a=!0,c=!1,f=void 0;try{for(var l,s=Object.keys(i)[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var y=l.value;e(t,y,i[y],o,u)}}catch(e){c=!0,f=e}finally{try{!a&&s.return&&s.return()}finally{if(c)throw f}}}}(e,"",t,function(e){return r.push(e)}),r}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function e(t,r,i){if(0===t.length)return i(r);if("object"!==(void 0===r?"undefined":n(r)))return r;var o=Object.assign({},r),u=!0,a=!1,c=void 0;try{for(var f,l=Object.keys(r)[Symbol.iterator]();!(u=(f=l.next()).done);u=!0){var s=f.value;s.toUpperCase()===t[0]&&(o[s]=e(t.slice(1),r[s],i))}}catch(e){a=!0,c=e}finally{try{!u&&l.return&&l.return()}finally{if(a)throw c}}return o}},function(e,t,r){"use strict";e.exports=function(e){var t=void 0,r=void 0,n=!0,i=!1,o=void 0;try{for(var u,a=["SET_ALL","SET_IN","SET","INCREMENT_ALL","INCREMENT_IN","INCREMENT","DECREMENT_ALL","DECREMENT_IN","DECREMENT","TOGGLE_ALL","TOGGLE_IN","TOGGLE","ADD_TO","ADD","INSERT_IN","INSERT","REMOVE_ALL","REMOVE_FROM","REMOVE","MERGE_ALL","MERGE_IN","MERGE"][Symbol.iterator]();!(n=(u=a.next()).done);n=!0){var c=u.value;if(e.startsWith(c))return{verb:t=c,path:r=e.replace(t,"").replace("_","")}}}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return{verb:t,path:r}}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var l=r(13),s=r(12),y=r(11),v=r(10),d=r(2),h=r(0).replace,p=function(e,t){var r=y(e,t);if(0===r.length)throw new Error("Path not found.");if(r.length>1)throw new Error("Path not unique, try a longer path specification.");return r[0].split("_")};function E(e,t,r){return void 0===t?e:Array.isArray(e)?r.index?[].concat(f(e.slice(0,r.index)),f(t),f(e.slice(r.index))):[].concat(f(e),f(t)):"object"===(void 0===e?"undefined":u(e))?Object.assign(o({},e),t):void 0}function b(e,t,r){if(Array.isArray(e))return e.map(function(e,n){return void 0===r||r(e,n)?t(e):e});if("object"===(void 0===e?"undefined":u(e))&&null!==e){var n={};return Object.entries(e).map(function(e){var o=i(e,2),u=o[0],a=o[1];void 0===r||r(u,a)?n[u]=t(u,a):n[u]=a}),n}}function m(e,t){if(Array.isArray(e))return void 0===t?[]:e.filter(function(e,r){return!t(e,r)});if("object"===(void 0===e?"undefined":u(e))&&null!==e){if(void 0===t)return{};var r={};return Object.entries(e).map(function(e){var n=i(e,2),o=n[0],u=n[1];t(o,u)||(r[o]=u)}),r}}function g(e,t){switch(t.type){case"ADD":return[].concat(f(e),[t.value]);case"CONCAT":return[].concat(f(e),f(t.value));case"REMOVE_ALL":return m(e);case"REMOVE_IN":if(void 0!==t.where)return m(e,t.where);if(void 0===t.index&&(t.index=e.length-1),void 0!==t.index)return m(e,function(e,r){return r===t.index});case"SET_IN":if(void 0!==t.index)return b(e,function(){return t.value},function(e,r){return r===t.index});if(void 0!==t.where)return b(e,function(){return t.value},t.where);case"SET_ALL":return b(e,function(){return t.value});case"TOGGLE_IN":if(void 0!==t.index)return b(e,function(e){return!e},function(e,r){return r===t.index});if(void 0!==t.where)return b(e,function(e){return!e},t.where);case"TOGGLE_ALL":return b(e,function(e){return!e});case"INCREMENT_IN":if(void 0!==t.index)return b(e,function(e){return e+t.value},function(e,r){return r===t.index});if(void 0!==t.where)return b(e,function(e){return e+t.value},t.where);case"DECREMENT_IN":if(void 0!==t.index)return b(e,function(e){return e-t.value},function(e,r){return r===t.index});if(void 0!==t.where)return b(e,function(e){return e-t.value},t.where);case"UPDATE_IN":return b(e,t.set,t.where);case"INSERT":return[].concat(f(e.slice(0,t.index)),[t.value],f(e.slice(t.index)));case"INCREMENT_ALL":return b(e,function(e){return e+t.value});case"DECREMENT_ALL":return b(e,function(e){return e-t.value});case"MERGE_ALL":return b(e,function(e){return Object.assign(o({},e),t.value)});case"MERGE_IN":if(void 0!==t.index)return b(e,function(e){return Object.assign(o({},e),t.value)},function(e,r){return r===t.index});if(void 0!==t.where)return b(e,function(e){return Object.assign(o({},e),t.value)},t.where);default:return e}}function w(e,t){var r=l(t.type),n=r.verb,a=r.path,y={};if(a){if("SET_IN"===n)return void 0!==t.key?s(p(a,e),e,function(e){return o({},e,c({},t.key,t.value))}):void 0!==t.index?s(p(a,e),e,function(e){return b(e,function(){return t.value},function(e,r){return r===t.index})}):void 0!==t.where?s(p(a,e),e,function(e){return b(e,function(){return t.value},t.where)}):s(p(a,e),e,function(){return t.value});if("INCREMENT_ALL"===n)return s(p(a,e),e,function(e){return b(e,function(e){return e+t.value})});if("INCREMENT_IN"===n){if(void 0!==t.index)return s(p(a,e),e,function(e){return b(e,function(e){return e+t.value},function(e,r){return r===t.index})});if(void 0!==t.where)return s(p(a,e),e,function(e){return b(e,function(e){return e+t.value},t.where)})}if("DECREMENT_ALL"===n)return s(p(a,e),e,function(e){return b(e,function(e){return e-t.value})});if("DECREMENT_IN"===n){if(void 0!==t.index)return s(p(a,e),e,function(e){return b(e,function(e){return e-t.value},function(e,r){return r===t.index})});if(void 0!==t.where)return s(p(a,e),e,function(e){return b(e,function(e){return e-t.value},t.where)})}if("INCREMENT"===n)return s(p(a,e),e,function(e){return e+t.value});if("DECREMENT"===n)return s(p(a,e),e,function(e){return e-t.value});if("TOGGLE"===n)return s(p(a,e),e,function(e){return!e});if("TOGGLE_IN"===n){if(void 0!==t.index)return s(p(a,e),e,function(e){return b(e,function(e){return!e},function(e,r){return r===t.index})});if(void 0!==t.key)return s(p(a,e),e,function(e){return b(e,function(e){return!e},function(e,r){return e===t.key})});if(void 0!==t.where)return s(p(a,e),e,function(e){return b(e,function(e){return!e},t.where)})}if("MERGE"===n)return s(p(a,e),e,function(e){return Object.assign(o({},e),t.value)});if("MERGE_IN"===n)return s(p(a,e),e,function(e){if(Array.isArray(e)){if(t.index){var r=[].concat(f(e));return r[t.index]=Object.assign(o({},r[t.index]),t.value),r}if(t.where)return e.map(function(e){return t.where(e)?"object"===(void 0===e?"undefined":u(e))?Object.assign(o({},e),t.value):t.value:e})}if("object"===(void 0===e?"undefined":u(e))){if(void 0!==t.key&&"object"===u(t.value))return o({},e,c({},t.key,Object.assign(o({},e[t.key]),t.value)));if(void 0!==t.key)return o({},e,c({},t.key,t.value));if(void 0!==t.where)return Object.entries(e).forEach(function(e){var r=i(e,2),n=r[0],u=r[1];t.where(n,u)?y[n]=Object.assign(o({},u),t.value):y[n]=o({},u)}),y}});if("MERGE_ALL"===n)return s(p(a,e),e,function(e){return Object.entries(e).forEach(function(e){var r=i(e,2),n=r[0],u=r[1];Array.isArray(u)?y[n]=[].concat(f(u)):y[n]=Object.assign(o({},u),t.value)}),y});if("ADD_TO"===n)return s(p(a,e),e,function(e){return[].concat(f(e),[t.value])});if("INSERT_IN"===n)return s(p(a,e),e,function(e){return[].concat(f(e.slice(0,t.index)),[t.value],f(e.slice(t.index)))});if("REMOVE_ALL"===n)return s(p(a,e),e,function(e){return m(e)});if("REMOVE_FROM"===n){if(void 0!==t.index)return s(p(a,e),e,function(e){return m(e,function(e,r){return r===t.index})});if(void 0!==t.where)return s(p(a,e),e,function(e){return m(e,t.where)})}if("SET_ALL"===n)return s(p(a,e),e,function(e){return b(e,function(e){return t.value})});if("TOGGLE_ALL"===n)return s(p(a,e),e,function(e){return b(e,function(e){return!e})})}switch(t.type){case"SET_ALL":return b(e,function(){return t.value});case"SET_IN":if(void 0!==t.key)return E(e,c({},t.key,t.value));if(void 0!==t.where)return b(e,function(){return t.value},t.where);case"MERGE_IN":if(void 0!==t.key)return b(e,function(e,r){return Object.assign(o({},r),t.value)},function(e,r){return e===t.key});if(void 0!==t.where)return b(e,function(e,r){return Object.assign(o({},r),t.value)},t.where);case"MERGE_ALL":return b(e,function(e,r){return Object.assign(o({},r),t.value)});case"MERGE":return E(e,t.value);case"REMOVE_ALL":return m(e);case"REMOVE_IN":if(void 0!==t.key)return m(e,function(e,r){return e===t.key});if(void 0!==t.where)return m(e,t.where);case"INCREMENT_IN":if(void 0!==t.key)return b(e,function(e,r){return r+t.value},function(e){return e===t.key});if(void 0!==t.where)return b(e,function(e,r){return r+t.value},t.where);case"DECREMENT_IN":if(void 0!==t.key)return b(e,function(e,r){return r-t.value},function(e){return e===t.key});if(void 0!==t.where)return b(e,function(e,r){return r-t.value},t.where);case"TOGGLE_IN":if(void 0!==t.key)return b(e,function(e,t){return!t},function(e){return e===t.key});if(void 0!==t.where)return b(e,function(e,t){return!t},t.where);case"TOGGLE_ALL":return b(e,function(e,t){return!t});default:return e}}function _(e,t,r,n){if(!t)throw new Error("All actions need to have a configuration object.");!function(e,t){if(e){var r=y(e,t);if(0===r.length)throw new Error("Path: "+e+" could not be found.");if(r.length>1)throw new Error("Multiple valid paths found. Use a longer path to ensure a unique selection.")}}(t.path,n),function(e,t,r){if(t){if(r.includes("value")&&!("value"in t))throw new Error(e+" should include a value property in the payload.");if(r.includes("in")&&void 0===t.index&&void 0===t.key&&void 0===t.where)throw new Error(e+" should include either a key, index, or where property in the payload.")}}(e,t,r);var i=t.path;return delete t.path,i?Object.assign({type:e+"_"+i},t):Object.assign({type:e},t)}var O=function(){function e(t){a(this,e),this.closedState=t}return n(e,[{key:"SET_ALL",value:function(e){return _("SET_ALL",e,["value"],this.closedState.state)}},{key:"SET_IN",value:function(e){return _("SET_IN",e,["value","in"],this.closedState.state)}},{key:"SET",value:function(e){return _("SET",e,["value"],this.closedState.state)}},{key:"INCREMENT_ALL",value:function(e){return _("INCREMENT_ALL",e,["value"],this.closedState.state)}},{key:"INCREMENT_IN",value:function(e){return _("INCREMENT_IN",e,["value","in"],this.closedState.state)}},{key:"INCREMENT",value:function(e){return _("INCREMENT",e,["value"],this.closedState.state)}},{key:"DECREMENT_ALL",value:function(e){return _("DECREMENT_ALL",e,["value"],this.closedState.state)}},{key:"DECREMENT_IN",value:function(e){return _("DECREMENT_IN",e,["value","in"],this.closedState.state)}},{key:"DECREMENT",value:function(e){return _("DECREMENT",e,["value"],this.closedState.state)}},{key:"TOGGLE_ALL",value:function(e){return _("TOGGLE_ALL",e,[],this.closedState.state)}},{key:"TOGGLE_IN",value:function(e){return _("TOGGLE_IN",e,["in"],this.closedState.state)}},{key:"TOGGLE",value:function(e){return _("TOGGLE",e,[],this.closedState.state)}},{key:"ADD_TO",value:function(e){return _("ADD_TO",e,["value"],this.closedState.state)}},{key:"ADD",value:function(e){return _("ADD",e,["value"],this.closedState.state)}},{key:"INSERT_IN",value:function(e){return _("INSERT_IN",e,["value","in"],this.closedState.state)}},{key:"INSERT",value:function(e){return _("INSERT",e,["value"],this.closedState.state)}},{key:"UPDATE_IN",value:function(e){return _("UPDATE_IN",e,["in"],this.closedState.state)}},{key:"REMOVE_ALL",value:function(e){return _("REMOVE_ALL",e,[],this.closedState.state)}},{key:"REMOVE_IN",value:function(e){return _("REMOVE_IN",e,["in"],this.closedState.state)}},{key:"REMOVE",value:function(e){return _("REMOVE",e,[],this.closedState.state)}},{key:"MERGE_ALL",value:function(e){return _("MERGE_ALL",e,["value"],this.closedState.state)}},{key:"MERGE_IN",value:function(e){return _("MERGE_IN",e,["value","in"],this.closedState.state)}},{key:"MERGE",value:function(e){return _("MERGE",e,["value"],this.closedState.state)}}]),e}(),T=new function e(){var t=this;a(this,e),this.closedState={},this.deduce=function(e){var r=e(void 0,{}),n=d(r),i=n&&v(r);return function(r,o){var a=e(r,o);return i=n?i[h](a):a,t.closedState.state=i,i!==r?i:"number"==typeof r?(t.closedState.state=function(e,t){switch(t.type){case"INCREMENT":return e+t.value;case"DECREMENT":return e-t.value;case"SET":return t.value;default:return e}}(r,o),t.closedState.state):"boolean"==typeof r?(t.closedState.state=function(e,t){switch(t.type){case"SET":return t.value;case"TOGGLE":return!e;default:return e}}(r,o),t.closedState.state):"string"==typeof r?(t.closedState.state=function(e,t){switch(t.type){case"SET":return t.value;default:return e}}(r,o),t.closedState.state):Array.isArray(r)?(t.closedState.state=g(r,o),t.closedState.state):"object"===(void 0===r?"undefined":u(r))&&null!==r?(t.closedState.state=w(r,o),t.closedState.state):void 0}},this.actions=new O(this.closedState)};e.exports={deduce:T.deduce,D:T.actions}}])});
//# sourceMappingURL=dedux.js.map